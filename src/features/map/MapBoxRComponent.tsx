import React, { useRef, useState, useEffect } from 'react';
import maplibregl, { Map, MapGeoJSONFeature } from 'maplibre-gl';
import 'maplibre-gl/dist/maplibre-gl.css';
import SearchRainfallData from '../search/SearchRainfallData';
import SeachClimateChangePrediction from '../search/SeachClimateChangePrediction';
import { addPolygonLayer } from './MapUtil';

import {
  LogoImg,
  SelectPlaceName,
  CloseButton,
  SelectedText,
  SelectButton,
  SearchContents,
  SearchButton,
  FutureSearchButton,
  IconContents,
  SplitscreenIcon,
  StorageIcon,
  LogoutIcon,
} from './style';

const MapRasterComponent: React.FC = () => {
  const mapContainer = useRef<HTMLDivElement | null>(null);
  const map = useRef<Map | null>(null);
  const [selectedPlaces, setSelectedPlaces] = useState<string[]>([]);
  const [changeWidth, setChangeWidth] = useState<string>('100%');
  const [openRainfall, setopenRainfall] = useState<boolean>(false);
  const [openClimateChangePrediction, setopenClimateChangePrediction] = useState<boolean>(false);

  const rainCoordinates: number[][] = [
    [136.29556257039889,35.6774690781054],[136.299636775601,35.67995867028529],[136.2991364745982,35.682454747889025],[136.29616525423953,35.68620437078445],[136.2936246774487,35.68834907430454],[136.29356856973553,35.69286369137125],[136.29949130363255,35.69584609197667],[136.30265352853985,35.69800902541085],[136.3046734574971,35.701382953274724],[136.3067167326519,35.70376089691441],[136.30862844164324,35.704544413379544],[136.31137368490377,35.70688191556826],[136.31159970866162,35.70707435985656],[136.3128477853756,35.71017932377642],[136.3134105955319,35.71326161665501],[136.3189370981175,35.71762902767875],[136.32345257931925,35.71821061334255],[136.32491946998073,35.72070149055762],[136.32201589028747,35.72320412167475],[136.32231587370453,35.72534174138198],[136.32407472985358,35.72795064431943],[136.3268550476817,35.73091315416876],[136.32818242315236,35.73482997689328],[136.32658886672536,35.7370915308814],[136.3266092405063,35.74208111455792],[136.3253209593887,35.7477870425444],[136.32082238964736,35.752551152509625],[136.3200913412051,35.755607669253095],[136.32140423121044,35.7575796109164],[136.321542924541,35.75778791966607],[136.3219693768856,35.76131497432835],[136.32406098258784,35.76878576322996],[136.32893801333967,35.77708936928212],[136.33286092075042,35.7786750399072],[136.34141577213452,35.77764225375045],[136.34739984806757,35.77888514157916],[136.35644373692963,35.78705107808981],[136.36279866838137,35.78952652292985],[136.36812599700707,35.79052010274552],[136.37296770900255,35.79426997943776],[136.377514038245,35.79627223363277],[136.38493741263773,35.795834504084034],[136.3880291187507,35.79565219740737],[136.39059043424973,35.79203223373071],[136.39401042378555,35.79008313857948],[136.39831715708027,35.79049664516842],[136.4023373830832,35.79115345826205],[136.40319636579866,35.787912048871725],[136.4063341582649,35.78601666166355],[136.40931461330743,35.7839912031185],[136.41270705272044,35.78279952336959],[136.4148735533718,35.78312818574889],[136.41818171895721,35.78496504569683],[136.4214788087381,35.78428119140886],[136.42555647607657,35.78121260824359],[136.43550395284473,35.77642240493477],[136.44281529129708,35.77702851300843],[136.4468778629872,35.77606448684007],[136.45902056701274,35.780495095153036],[136.46306379839845,35.780842068543095],[136.4683966489608,35.77573890890475],[136.47629613670827,35.77520696916702],[136.48361095341593,35.776239935276095],[136.48827110680693,35.77895911734947],[136.4885336551342,35.77420607643618],[136.49507061933437,35.77061564518248],[136.49752590591422,35.766922928730175],[136.50039383313268,35.75918936194888],[136.50429791798888,35.75406519145447],[136.50597518954478,35.75241471309773],[136.50822484207342,35.752978189215796],[136.50896562848547,35.75487584649928],[136.50928345303439,35.759270330517815],[136.51425965221563,35.76221888062423],[136.51471451614398,35.76494931359359],[136.51478113311768,35.775284536737864],[136.51597782166283,35.777578214372475],[136.52109755709725,35.783100364923975],[136.52518366590124,35.79064008452782],[136.53573274982074,35.78386931536872],[136.54213790026495,35.78241413670086],[136.54922798749536,35.78145624662182],[136.55846552611644,35.78210108854518],[136.5628342781327,35.78148691648423],[136.568085513,35.78181840641693],[136.57200716479034,35.77990010189709],[136.57464107709717,35.78119399819354],[136.57844833965385,35.783432540416314],[136.58677869177373,35.78612414311525],[136.58666782934748,35.79087661083084],[136.5875649241679,35.79443892515267],[136.59109046536045,35.79774727357599],[136.5970724691152,35.79777037215289],[136.59956515472254,35.799842395152176],[136.60247905212222,35.799471134365994],[136.60674772012615,35.794935681930426],[136.60929661446153,35.79468444022686],[136.61233533544396,35.791580195699055],[136.6171377397515,35.79024891633367],[136.62436087430893,35.78965718944335],[136.6277935127489,35.79185682868192],[136.62764058387393,35.797800887212034],[136.63516903297116,35.797760273259314],[136.6399368928031,35.80067463497488],[136.64224262340738,35.80519832461206],[136.6460197334348,35.80831224572169],[136.64746387677266,35.80805423945266],[136.6523977802921,35.80229348423315],[136.6531732968502,35.800294147016736],[136.65544118642077,35.78784989280454],[136.66042264195605,35.78591314552033],[136.66469383342104,35.78648245095416],[136.6700064639688,35.791044171182],[136.67684570853643,35.79503843196359],[136.68288406375734,35.791900615222225],[136.68928358767943,35.792042932617946],[136.6942050041955,35.79241566772188],[136.69901718960102,35.79541479580886],[136.70324199054863,35.795054224466966],[136.70694238307735,35.793688678604646],[136.7111697058516,35.793831454935216],[136.71408236775738,35.796923635912606],[136.72020080702634,35.80058183146092],[136.72352063924666,35.804463236110266],[136.72466089324482,35.80944848285608],[136.73311487256953,35.80897998741962],[136.7421490066814,35.8024305227636],[136.75720212190316,35.81150276918289],[136.7601961796736,35.81195891412893],[136.76551837596443,35.811865668740346],[136.77221679991865,35.8092569636197],[136.7759397523002,35.808733028768756],[136.778175843361,35.80151019930583],[136.78232153205903,35.800413532869015],[136.78930860262028,35.80117598280211],[136.79428937136728,35.808531051469636],[136.796810641229,35.81118108479582],[136.79794166415508,35.814607276037385],[136.7997380738908,35.82102785062343],[136.79902959911473,35.824751110273084],[136.79969653011383,35.831422746511954],[136.8009714493305,35.83502115832396],[136.80260469453307,35.83946545485161],[136.80450009813447,35.84481459967954],[136.81573267107157,35.84462012287263],[136.8264805603458,35.846922566994806],[136.82990252325703,35.850155500826496],[136.8323960507131,35.85529101568984],[136.83307215802915,35.861356482812305],[136.8318153381383,35.86677033965228],[136.82853200256287,35.87127428895953],[136.82478893520295,35.87881700045456],[136.8233674037025,35.87997966755453],[136.82332730333377,35.880012465549534],[136.8229038541895,35.88035880359334],[136.82197961158423,35.88240007936388],[136.8237008047099,35.88609371052934],[136.82422169777092,35.894501705028084],[136.82186944294028,35.899982339955976],[136.81718138695263,35.90553823963516],[136.81606764171568,35.91083213154486],[136.81397354024043,35.9131034236481],[136.80683302406675,35.9145771422509],[136.7994890295472,35.921730719229664],[136.78947971708592,35.922575609857645],[136.78526656918766,35.92567322066391],[136.78589074842915,35.930693819036286],[136.78722748854966,35.93263796328297],[136.7939701067592,35.94257938149433],[136.79402658787362,35.948221686136755],[136.80012627996672,35.95186374974019],[136.80477097016347,35.95604983459312],[136.80854495990445,35.96077617004516],[136.81141403185111,35.969844432726724],[136.8207533691523,35.98266985237158],[136.82075414959013,35.989797376673366],[136.82532289729144,35.99338917189238],[136.825379938611,35.993464715958254],[136.82779543682258,35.99666373739125],[136.8322589365266,35.999637192580536],[136.8386063595216,36.00349521229195],[136.8344730650225,36.008590626068475],[136.82982915277438,36.01183059561413],[136.82491808399433,36.010616896570156],[136.82177512153697,36.01069781383989],[136.81376544738984,36.013841255057976],[136.80885590578686,36.02700082306731],[136.8057911465146,36.03027905419149],[136.80436030258022,36.03071364575728],[136.7974884308524,36.03081920773804],[136.79693014401494,36.03343638761008],[136.79904397416615,36.039102570822],[136.80213973852372,36.04248892079289],[136.7982662904798,36.04982088973515],[136.79579769513,36.05179709110572],[136.78782437400574,36.05173088002298],[136.78206829440794,36.053966258050785],[136.77804649758642,36.054111359484054],[136.7712073540521,36.05783794128792],[136.76561062353187,36.06274981903715],[136.7661371830161,36.06781270307751],[136.76638143184854,36.070365159339744],[136.7654776248101,36.07524138810539],[136.76191062822807,36.07728501440397],[136.75880070152493,36.0811056490412],[136.75683051564366,36.08165243719565],[136.7543402328062,36.08687885529046],[136.75005880495436,36.08519983501034],[136.7456626009173,36.08451398209977],[136.74130977643784,36.08062048816215],[136.73004813500336,36.0812239548298],[136.72420307312217,36.08209125923543],[136.71860668695308,36.081933699402974],[136.71453605470975,36.081081280267185],[136.70690484778592,36.07910606986725],[136.70101303799586,36.074626271495035],[136.69588739317828,36.073886670786855],[136.69265610293988,36.072540023526216],[136.68841300082198,36.072620766591086],[136.68657482720923,36.071562339578264],[136.6786435544876,36.07058330789479],[136.67655150271062,36.067907179570774],[136.6623864367318,36.068291039614714],[136.65975117448437,36.07036759077647],[136.65975117448437,36.07036759077646],[136.65820628078484,36.07241726981825],[136.6576709031618,36.073127549699706],[136.6564660842045,36.07627168276],[136.65634647856538,36.08427697101937],[136.65373689297547,36.08726107676723],[136.65157260559496,36.091014752775656],[136.65114145010125,36.091402599514346],[136.64845001768882,36.09382356063969],[136.64233835539892,36.0980147406854],[136.63736967179645,36.099287877856796],[136.63305602733882,36.09972715274203],[136.62536541916566,36.10595045644881],[136.62176151206225,36.10620028085303],[136.61774197130933,36.10699320294822],[136.61344760502817,36.10945832141217],[136.61254454482264,36.11634498697211],[136.61105440730734,36.11794842232257],[136.60501259128986,36.122565476603704],[136.60402808070126,36.12638342196642],[136.60246853174385,36.12934429959174],[136.6004818247629,36.130530068430446],[136.59406220561934,36.13116817696136],[136.59025843063554,36.13160270041206],[136.58646356181106,36.133225092882306],[136.58596482706568,36.13500965236569],[136.58355182938374,36.135496430816055],[136.58092524219734,36.136815774495105],[136.57761106721605,36.1407548960801],[136.5738657655387,36.14278930509261],[136.57072050142804,36.143279608283414],[136.56706221614849,36.14371298524097],
    [136.56436257319507,36.145091430219736],[136.56175433289252,36.14902379057934],[136.56090304619383,36.15288848220744],[136.55650737228171,36.15326860296885],[136.55087777911157,36.154600147783015],[136.54676398497475,36.15265823962058],[136.5392941770385,36.15257240539625],[136.53781650367597,36.15061886504819],[136.53443137475654,36.14813918013376],[136.53061885716855,36.14744325289883],[136.5293059810927,36.14822118981434],[136.52744684831785,36.14968592612977],[136.52558764601318,36.151150634930445],[136.5214843479576,36.15075199246222],[136.51832996906194,36.14987422188096],[136.51303580842875,36.14645136490542],[136.50703014223663,36.1462982490676],[136.50374063209838,36.14720291788155],[136.50258222497112,36.149286604523695],[136.49723860702915,36.14960590365359],[136.49516968124036,36.155462035575525],[136.49197997944623,36.15822987028761],[136.48877163440088,36.15849479650323],[136.4860738095175,36.157581680380176],[136.47931406806475,36.15282098420535],[136.47420538538566,36.147129644690466],[136.47046902519145,36.14571672227062],[136.46764759039365,36.14152814481158],[136.46264876842594,36.137010964606716],[136.45451643736243,36.13727467873323],[136.4490274732967,36.1403507435031],[136.4448628149127,36.13956393875859],[136.44074863372447,36.136845434781954],[136.43902107439982,36.14195266547711],[136.43369600311607,36.143392621685926],[136.42733613831962,36.148410303078414],[136.42740558271558,36.1501708612669],[136.42341882577512,36.1547196386202],[136.41609538047794,36.15557880692367],[136.4151462920716,36.158588861067585],[136.41281109838653,36.160200693438796],[136.413281278541,36.166079212375884],[136.41323769702848,36.168535102918604],[136.40797617399832,36.171998968399706],[136.40547873003788,36.17046290379869],[136.39873923093998,36.17048975256281],[136.3937306737926,36.167520573640566],[136.38308463603155,36.16754251271328],[136.376463920835,36.16865703033352],[136.37278846242688,36.170217348744345],[136.36946942448097,36.169387916484695],[136.36577494653386,36.16587087838858],[136.35883298574674,36.16555582857406],[136.3579553306209,36.166188447993626],[136.35576778028206,36.16831297044021],[136.3518672219692,36.16908889718273],[136.34602004626848,36.17254895071599],[136.34245968147656,36.175269718976075],[136.34060363560553,36.17841697522012],[136.33936534561823,36.18181410861162],[136.33622231898943,36.18634183167746],[136.33759616373712,36.19002956537276],[136.33643088008807,36.19407841071574],[136.33308046970106,36.195509373920935],[136.33206089822423,36.20038657643563],[136.32961354253268,36.20351756748945],[136.3283566059342,36.207826162923766],[136.33125231572907,36.214755941228816],[136.33213571808076,36.21808629054513],[136.33052935269382,36.2205868825641],[136.33032917549045,36.22444350744105],[136.33085939019406,36.22830585885502],[136.32865223197732,36.2316505527834],[136.32340102965966,36.231662382751445],[136.31915637274912,36.23380985694885],[136.31609012980402,36.2376178453118],[136.31187261485383,36.237858653704215],[136.30679794402042,36.23908921605744],[136.30099342369357,36.23895738209852],[136.2963116898122,36.24193734595236],[136.28282259504758,36.241729103981115],[136.2776454819835,36.23833543243655],[136.27166419846097,36.236047493241955],[136.26593005396938,36.235577120980295],[136.25864949065164,36.235607362314646],[136.25146422942476,36.236433094503845],[136.24776261942395,36.23586580369787],[136.24410638343838,36.23860595484377],[136.22738382964278,36.23852106133384],[136.21490765825482,36.233315635115474],[136.20478793466756,36.23214507513704],[136.20156340583137,36.233738839885696],[136.20363280070154,36.2390369232692],[136.20215823133054,36.24314783656892],[136.18904425364082,36.235127156360825],[136.18764074433605,36.23978245437608],[136.18030906959237,36.23434556022385],[136.1826449417788,36.23018455141156],[136.17765351724518,36.22722208355779],[136.17399135073035,36.22865293636576],[136.1687128802571,36.22842310854936],[136.1675402724308,36.22994598334684],[136.15687906657007,36.2285594957573],[136.15374295321126,36.22759533005722],[136.15081535229703,36.224741422644506],[136.1519808787379,36.22093862383984],[136.1543751699355,36.21770739000046],[136.15474682829336,36.21524374847046],[136.15341390154114,36.210138011881355],[136.15032715449092,36.207173526225645],[136.1466649742904,36.206702089233886],[136.1431458738478,36.20623227120611],[136.1394780997429,36.19613832906619],[136.13303296339535,36.18640389538734],[136.12856064918162,36.17992594359705],[136.10902413854603,36.15784824334768],[136.11141379377392,36.155187965840234],[136.0999226812593,36.14657511650445],[136.10129095989083,36.14309556782099],[136.10395047401343,36.1404842405589],[136.1093250206594,36.13459784667235],[136.11040899766016,36.13193517771033],[136.12046603274513,36.12611109058067],[136.1200424635979,36.11837805753092],[136.11599516688892,36.11443018877112],[136.1097782426692,36.11057203569132],[136.108738830399,36.107464960958175],[136.10946087232824,36.105616306491456],[136.112668130837,36.104437335180734],[136.10572450254915,36.09915186652587],[136.10189325467718,36.09730709998483],[136.09671781401758,36.096303711965504],[136.09081290483303,36.09068181993904],[136.0846000635935,36.08606840969553],[136.0844885532525,36.08186450388766],[136.0861423440688,36.0800993207921],[136.09307035516667,36.07572612409805],[136.09792916304193,36.07211023736795],[136.107029274557,36.06723084384224],[136.11054221756012,36.06512749135907],[136.10495401228332,36.06236085041468],[136.08715256698486,36.05582614136415],[136.07893893526548,36.05159865686015],[136.07607599151768,36.05012488464328],[136.06770041915254,36.048194911683055],[136.06770041915254,36.04819491168306],[136.06770041915252,36.04819491168305],[136.0677004191525,36.04819491168304],[136.0677004191525,36.04819491168302],[136.06391502666952,36.045293926796255],[136.0573916945442,36.03496471264078],[136.0533433299749,36.0155616470432],[136.0516851574696,36.01136258036608],[136.0489942513974,36.008508153909396],[136.04516827671677,36.003047392060864],[136.03679414424093,35.99918655525984],[136.02914266390732,35.99389740964702],[136.02541971284816,35.990286776949155],[136.02345332344927,35.98583544609896],[136.01942490324774,35.98365044729111],[136.0204372932444,35.97632475143632],[136.0220047436009,35.97516559117248],[136.0149516566009,35.96802309584175],[136.01187407721653,35.962147809226],[136.01176934018255,35.958451744439515],[136.01425235556562,35.9552594259453],[136.01435482860705,35.94866209840587],[136.02034648041956,35.94820246990648],[136.02065454097604,35.94459026327672],[136.01724235532205,35.93938129504081],[136.01620747252383,35.93182125206633],[136.01037930941885,35.93143637215895],[136.01124945522534,35.92938607423184],[136.0151726111908,35.9254371052288],[136.01207355044167,35.917877207045315],[136.01351989752473,35.91451772027488],[136.01641027059304,35.91241699678513],[136.01868132600663,35.91090443288824],[136.0194937041869,35.90525367505964],[136.02580395438292,35.905022666481216],[136.02384019905216,35.899478950453094],[136.0209480908072,35.89628753968373],[136.0210318310155,35.89418560268444],[136.02084146448098,35.881670762676144],[136.02409777516678,35.879294561562816],[136.03136905973457,35.87914838496428],[136.03438915171623,35.88063557770908],[136.03674870625895,35.88063470226632],[136.04769100246222,35.87475096048987],[136.05177564781567,35.871897829451626],[136.0661510251406,35.87028713820113],[136.07206964445845,35.86716967109326],[136.07168417409096,35.86151147462209],[136.07165189418805,35.86103761109373],[136.07299170049404,35.859188801028004],[136.07577587245916,35.85717120268086],[136.07969191113352,35.851372816605235],[136.08072137805874,35.84960777769174],[136.08546390689816,35.84565597709106],[136.09659415789682,35.846094469595684],[136.09991035736041,35.84673665579735],[136.1019732909628,35.84631487787005],[136.10457416794986,35.8445457435781],[136.1086783942222,35.84538511860705],[136.11317452850406,35.84737803926255],[136.11559546422956,35.84840289865868],[136.11848460033693,35.848483937002285],[136.12068234937925,35.84765406651664],[136.12264111846994,35.84672772732362],[136.12718041808685,35.84638638206501],[136.1296538926386,35.8443675728327],[136.13057912681043,35.84251839325758],[136.13015390899702,35.83554659899171],[136.13241480511365,35.83033628116951],[136.13178595508435,35.8250448238721],[136.13590032784546,35.817058755029954],[136.1377465071627,35.811176390230216],[136.1404239617821,35.80856958447301],[136.1406537580406,35.80388599288112],[136.14434116047622,35.798729904039874],[136.1485688642647,35.798011513786356],[136.15089648664292,35.79515723828044],[136.1501362714956,35.789853059774245],[136.14322136900788,35.78620792459609],[136.13713209553433,35.782981731013585],[136.1332149662912,35.78248036983561],[136.12897958556337,35.779128204551206],[136.1250719162928,35.778770479886084],[136.12276920471328,35.77798009366778],[136.1197447667418,35.77515418210808],[136.11685072674058,35.773407506246805],[136.1173333291044,35.77016661557018],[136.11674794827067,35.76880106754788],[136.11521710534154,35.76862458987385],[136.11456062960224,35.76702040934541],[136.11855702436375,35.75982872661197],[136.11862250812985,35.755195422820464],[136.1239357670842,35.7512693711514],[136.12728134606928,35.74722659943426],[136.1320802235044,35.7433496716832],[136.13514041287488,35.74038722691811],[136.1352786018021,35.73652580519161],[136.13425179283226,35.732487729146904],[136.13526332307723,35.72761572432356],[136.1355492173162,35.72440776377003],[136.14461944609457,35.718145310640715],[136.1500699864057,35.713853874505844],[136.15170968664918,35.70965144863076],[136.15161239739928,35.7093911236588],[136.15067420406908,35.70688063025164],[136.14644308980465,35.704760436400555],[136.1516900244725,35.69948756458615],[136.15869950720307,35.702671224800596],[136.16209562946867,35.7014901455555],[136.16827366862267,35.7006406635064],[136.169002780899,35.70450416792708],
    [136.17096204484292,35.705593353008005],[136.17261775319156,35.705073349691],[136.1764800891157,35.705932871639014],[136.1815687177102,35.70490568037078],[136.18527772840767,35.70548825350332],[136.18960301657322,35.705313867882346],[136.19608425147865,35.702028097284526],[136.19915986640996,35.69563914226227],[136.1993098010778,35.69302053547127],[136.2006963715059,35.69185662808781],[136.2042984863303,35.6906752391737],[136.2091383670523,35.69033208040147],[136.21291269910824,35.68606397045627],[136.21478560048772,35.68611938315061],[136.21777458565634,35.687121592378986],[136.2231265996681,35.68635504961806],[136.22853289485724,35.6839988512323],[136.2314596905053,35.6839025465918],[136.23434645255597,35.6851569727124],[136.23681516883215,35.684312075387396],[136.24020267013626,35.680777193857885],[136.2437985767777,35.67808196080524],[136.24667742859552,35.676648219164264],[136.25460706926006,35.67705269744501],[136.26001291271203,35.674467304950824],[136.26467223159656,35.67439766801352],[136.26787368969053,35.67379662528748],[136.27317747871578,35.67045852083257],[136.2768834769208,35.66831194622301],[136.27986475621793,35.667176780174806],[136.28284855612722,35.66640317341588],[136.28692105783975,35.66686215108135],[136.2910096334257,35.6700005175375],[136.291751318972,35.6740380869992],[136.29556257039889,35.6774690781054]
  ];
  const testCoordinates: number[][] = [
    [136.41818171895721,35.78496504569683],[136.4214788087381,35.78428119140886],[136.42555647607657,35.78121260824359],[136.43550395284473,35.77642240493477],[136.44281529129708,35.77702851300843],[136.4468778629872,35.77606448684007],[136.45902056701274,35.780495095153036],[136.46306379839845,35.780842068543095],[136.4683966489608,35.77573890890475],[136.47629613670827,35.77520696916702],[136.48361095341593,35.776239935276095],[136.48827110680693,35.77895911734947],[136.4885336551342,35.77420607643618],[136.49507061933437,35.77061564518248],[136.49752590591422,35.766922928730175],[136.50039383313268,35.75918936194888],[136.50429791798888,35.75406519145447],[136.50597518954478,35.75241471309773],[136.50822484207342,35.752978189215796],[136.50896562848547,35.75487584649928],[136.50928345303439,35.759270330517815],[136.51425965221563,35.76221888062423],[136.51471451614398,35.76494931359359],[136.51478113311768,35.775284536737864],[136.51597782166283,35.777578214372475],[136.52109755709725,35.783100364923975],[136.52518366590124,35.79064008452782],[136.53573274982074,35.78386931536872],[136.54213790026495,35.78241413670086],[136.54922798749536,35.78145624662182],[136.55846552611644,35.78210108854518],[136.5628342781327,35.78148691648423],[136.568085513,35.78181840641693],[136.57200716479034,35.77990010189709],[136.57464107709717,35.78119399819354],[136.57844833965385,35.783432540416314],[136.58677869177373,35.78612414311525],[136.58666782934748,35.79087661083084],[136.5875649241679,35.79443892515267],[136.59109046536045,35.79774727357599],[136.5970724691152,35.79777037215289],[136.59956515472254,35.799842395152176],[136.60247905212222,35.799471134365994],[136.60674772012615,35.794935681930426],[136.60929661446153,35.79468444022686],[136.61233533544396,35.791580195699055],[136.6171377397515,35.79024891633367],[136.62436087430893,35.78965718944335],[136.6277935127489,35.79185682868192],[136.62764058387393,35.797800887212034],[136.63516903297116,35.797760273259314],[136.6399368928031,35.80067463497488],[136.64224262340738,35.80519832461206],[136.6460197334348,35.80831224572169],[136.64746387677266,35.80805423945266],[136.6523977802921,35.80229348423315],[136.6531732968502,35.800294147016736],[136.65544118642077,35.78784989280454],[136.66042264195605,35.78591314552033],[136.66469383342104,35.78648245095416],[136.6700064639688,35.791044171182],[136.67684570853643,35.79503843196359],[136.68288406375734,35.791900615222225],[136.68928358767943,35.792042932617946],[136.6942050041955,35.79241566772188],[136.69901718960102,35.79541479580886],[136.70324199054863,35.795054224466966],[136.70694238307735,35.793688678604646],[136.7111697058516,35.793831454935216],[136.71408236775738,35.796923635912606],[136.72020080702634,35.80058183146092],[136.72352063924666,35.804463236110266],[136.72466089324482,35.80944848285608],[136.73311487256953,35.80897998741962],[136.7421490066814,35.8024305227636],[136.75720212190316,35.81150276918289],[136.7601961796736,35.81195891412893],[136.76551837596443,35.811865668740346],[136.77221679991865,35.8092569636197],[136.7759397523002,35.808733028768756],[136.778175843361,35.80151019930583],[136.78232153205903,35.800413532869015],[136.78930860262028,35.80117598280211],[136.79428937136728,35.808531051469636],[136.796810641229,35.81118108479582],[136.79794166415508,35.814607276037385],[136.7997380738908,35.82102785062343],[136.79902959911473,35.824751110273084],[136.79969653011383,35.831422746511954],[136.8009714493305,35.83502115832396],[136.80260469453307,35.83946545485161],[136.80450009813447,35.84481459967954],[136.81573267107157,35.84462012287263],[136.8264805603458,35.846922566994806],[136.82990252325703,35.850155500826496],[136.8323960507131,35.85529101568984],[136.83307215802915,35.861356482812305],[136.8318153381383,35.86677033965228],[136.82853200256287,35.87127428895953],[136.82478893520295,35.87881700045456],[136.8233674037025,35.87997966755453],[136.82332730333377,35.880012465549534],[136.8229038541895,35.88035880359334],[136.82197961158423,35.88240007936388],[136.8237008047099,35.88609371052934],[136.82422169777092,35.894501705028084],[136.82186944294028,35.899982339955976],[136.81718138695263,35.90553823963516],[136.81606764171568,35.91083213154486],[136.81397354024043,35.9131034236481],[136.80683302406675,35.9145771422509],[136.7994890295472,35.921730719229664],[136.78947971708592,35.922575609857645],[136.78526656918766,35.92567322066391],[136.78589074842915,35.930693819036286],[136.78722748854966,35.93263796328297],[136.7939701067592,35.94257938149433],[136.79402658787362,35.948221686136755],[136.80012627996672,35.95186374974019],[136.80477097016347,35.95604983459312],[136.80854495990445,35.96077617004516],[136.81141403185111,35.969844432726724],[136.8207533691523,35.98266985237158],[136.82075414959013,35.989797376673366],[136.82532289729144,35.99338917189238],[136.825379938611,35.993464715958254],[136.82779543682258,35.99666373739125],[136.8322589365266,35.999637192580536],[136.8386063595216,36.00349521229195],[136.8344730650225,36.008590626068475],[136.82982915277438,36.01183059561413],[136.82491808399433,36.010616896570156],[136.82177512153697,36.01069781383989],[136.81376544738984,36.013841255057976],[136.80885590578686,36.02700082306731],[136.8057911465146,36.03027905419149],[136.80436030258022,36.03071364575728],[136.7974884308524,36.03081920773804],[136.79693014401494,36.03343638761008],[136.79904397416615,36.039102570822],[136.80213973852372,36.04248892079289],[136.7982662904798,36.04982088973515],[136.79579769513,36.05179709110572],[136.78782437400574,36.05173088002298],[136.78206829440794,36.053966258050785],[136.77804649758642,36.054111359484054],[136.7712073540521,36.05783794128792],
    [136.76561062353187,36.06274981903715],[136.7661371830161,36.06781270307751],[136.76638143184854,36.070365159339744],[136.7654776248101,36.07524138810539],[136.76191062822807,36.07728501440397],[136.75880070152493,36.0811056490412],[136.75683051564366,36.08165243719565],[136.7543402328062,36.08687885529046],[136.75005880495436,36.08519983501034],[136.7456626009173,36.08451398209977],[136.74130977643784,36.08062048816215],[136.73004813500336,36.0812239548298],[136.72420307312217,36.08209125923543],[136.71860668695308,36.081933699402974],[136.71453605470975,36.081081280267185],[136.70690484778592,36.07910606986725],[136.70101303799586,36.074626271495035],[136.69588739317828,36.073886670786855],[136.69265610293988,36.072540023526216],[136.68841300082198,36.072620766591086],[136.68657482720923,36.071562339578264],[136.6786435544876,36.07058330789479],[136.67655150271062,36.067907179570774],[136.6623864367318,36.068291039614714],[136.65975117448437,36.07036759077647],[136.65975117448437,36.07036759077646],[136.65820628078484,36.07241726981825],[136.6576709031618,36.073127549699706],[136.6564660842045,36.07627168276],[136.65634647856538,36.08427697101937],[136.65373689297547,36.08726107676723],[136.65157260559496,36.091014752775656],[136.65114145010125,36.091402599514346],[136.64845001768882,36.09382356063969],[136.64233835539892,36.0980147406854],[136.63736967179645,36.099287877856796],[136.63305602733882,36.09972715274203],[136.62536541916566,36.10595045644881],[136.62176151206225,36.10620028085303],[136.61774197130933,36.10699320294822],[136.61344760502817,36.10945832141217],[136.61254454482264,36.11634498697211],[136.61105440730734,36.11794842232257],[136.60501259128986,36.122565476603704],[136.60402808070126,36.12638342196642],[136.60246853174385,36.12934429959174],[136.6004818247629,36.130530068430446],[136.59406220561934,36.13116817696136],[136.59025843063554,36.13160270041206],[136.58646356181106,36.133225092882306],[136.58596482706568,36.13500965236569],[136.58355182938374,36.135496430816055],[136.58092524219734,36.136815774495105],[136.57761106721605,36.1407548960801],[136.5738657655387,36.14278930509261],[136.57072050142804,36.143279608283414],[136.56706221614849,36.14371298524097],[136.56436257319507,36.145091430219736],[136.56175433289252,36.14902379057934],[136.56090304619383,36.15288848220744],[136.55650737228171,36.15326860296885],[136.55087777911157,36.154600147783015],[136.54676398497475,36.15265823962058],[136.5392941770385,36.15257240539625],[136.53781650367597,36.15061886504819],[136.53443137475654,36.14813918013376],[136.53061885716855,36.14744325289883],[136.5293059810927,36.14822118981434],[136.52744684831785,36.14968592612977],[136.52558764601318,36.151150634930445],[136.5214843479576,36.15075199246222],[136.51832996906194,36.14987422188096],[136.51303580842875,36.14645136490542],[136.50703014223663,36.1462982490676],[136.50374063209838,36.14720291788155],[136.50258222497112,36.149286604523695],[136.49723860702915,36.14960590365359],[136.49516968124036,36.155462035575525],[136.49197997944623,36.15822987028761],[136.48877163440088,36.15849479650323],[136.4860738095175,36.157581680380176],[136.47931406806475,36.15282098420535],[136.47420538538566,36.147129644690466],[136.47046902519145,36.14571672227062],[136.46764759039365,36.14152814481158],[136.46264876842594,36.137010964606716],[136.45451643736243,36.13727467873323],[136.4490274732967,36.1403507435031],[136.4448628149127,36.13956393875859],[136.44074863372447,36.136845434781954],[136.4400092054219,36.13542239106285],[136.43882985392935,36.133882022175065],[136.43358434491287,36.13413416366606],[136.4300344004817,36.132129472047914],[136.421615559321,36.132332668461814],[136.40914875678166,36.128303795176464],[136.40369325329678,36.1275600042504],[136.39851239857032,36.12486947122318],[136.39251220938178,36.125148952871065],[136.3865157316059,36.127166545464824],[136.37757685014583,36.12600843307669],[136.3734891630624,36.12851671350801],[136.36806497008067,36.128790827742506],[136.36249995071216,36.12688471198146],[136.34970022862444,36.127012103092504],[136.3451018626414,36.131433065536825],[136.3384970659554,36.131590822146904],[136.32988014106436,36.132684679359166],[136.3236974467137,36.13688118943128],
    [136.32146617340356,36.132332851698756],[136.32031132550298,36.12745104988012],[136.31925809889083,36.11649339933968],[136.31809997815213,36.111708502516706],[136.3166289041857,36.10633644102363],[136.30545720234613,36.108634122952125],[136.2931436587459,36.11017884189867],[136.27902986329934,36.113618365263726],[136.27209918023138,36.11073332793948],[136.2648530406404,36.110498090312845],[136.25754741100585,36.11292645941273],[136.25067702770758,36.11279605546034],[136.2413981239895,36.11087853417111],[136.2303012020068,36.105225266180625],[136.22601442963278,36.10259957239843],[136.22238955942763,36.10168314508573],[136.2180407984105,36.101858064698185],[136.21256006246196,36.10321308508565],[136.21441591108982,36.10094135310779],[136.22082850413992,36.09891440482839],[136.2267020510539,36.09952165598791],[136.2366781092462,36.099893885333515],[136.24700817163418,36.09911717843264],[136.25456349807334,36.09825619209674],[136.26429473064718,36.09873955764614],[136.27515805763818,36.09753830981694],[136.28842621799635,36.09663274476193],[136.29906763233163,36.09723344949999],[136.3098806877536,36.099378869710634],[136.3186341082946,36.09903558154318],[136.32457067394816,36.09846369721974],[136.3206319473622,36.09696241294829],[136.31720683819142,36.094535732461246],[136.31357232813244,36.09152162218056],[136.31169396543572,36.087746735651706],[136.308845962013,36.08595444266582],[136.30848923021344,36.084870750932815],[136.30753136340653,36.081960757031965],[136.30455991609824,36.07740956181009],[136.30561407038311,36.07298683123268],[136.30850751823112,36.07140231967776],[136.31234363479285,36.07111271241467],[136.318719783709,36.054238777451665],[136.31900595888712,36.05141370166781],[136.31918558401867,36.049640369805175],[136.33235687921908,36.04951633759415],[136.33622663632264,36.053723824768745],[136.34060334780364,36.05295145403753],[136.3436169241179,36.050916784357504],[136.34565337391945,36.04817891628836],[136.3467159258531,36.043060951100685],[136.3529195413568,36.03675469046064],[136.359301227582,36.03600943693402],[136.36639589140978,36.03529477038495],[136.36923455817052,36.03566731236718],[136.369441916171,36.035694525684484],[136.37303589889711,36.038058838271816],[136.37897885871834,36.04219787205061],[136.38397750851888,36.04764553495096],[136.3972239681008,36.04902773383585],[136.4092574815292,36.04505616636362],[136.4203908842606,36.041762759823904],[136.42495336508347,36.04200501836492],[136.4290813087991,36.042224204696694],[136.43423279159748,36.04394326251826],[136.43513336389918,36.03873180325001],[136.43987257404984,36.032674520828344],[136.4427031127413,36.029364295536716],[136.44283474348632,36.029210349189036],[136.4448172215937,36.024197417088224],[136.44831995064814,36.0221298056328],[136.4507488037446,36.02069608802284],[136.45931583154047,36.01771108737825],[136.45730012191345,36.014309363997924],[136.45260865432962,36.0129138524732],[136.45168831148783,36.00912268758004],[136.45590206872924,36.00490662284928],[136.45562165115305,35.992139604814945],[136.45054218759665,35.9896389204527],[136.4480842436082,35.986376659967064],[136.45349665439537,35.98215162371814],[136.45232667295647,35.976444037291415],[136.45643319344887,35.97155637315858],[136.45555815078382,35.96307572949761],[136.45583669876547,35.957530619482846],[136.45806784882598,35.9556933160472],[136.45926490290148,35.95470751609246],[136.46408254806832,35.95388769846369],[136.46479584955054,35.952121006029074],[136.4621902450383,35.94537482278103],[136.4626547262135,35.93944474301437],[136.4659148492407,35.93136839293955],[136.46718033670658,35.92559154575693],[136.4668996374494,35.92363585105348],[136.4656553609136,35.922800566890174],[136.46234295096997,35.922310184537885],[136.46036517615875,35.91946146148543],[136.45641002003052,35.91532014512776],[136.45135368170605,35.91437080164723],[136.44607520907863,35.91212234838183],[136.44111297675585,35.91130262444317],[136.44108592162553,35.90617859579828],[136.43932443852492,35.905008720636644],[136.4346515139982,35.89998492329955],[136.43365125941762,35.89666950245317],[136.43620756889516,35.89216616281067],[136.43413597730918,35.890788156692224],[136.44063203587285,35.88728974397943],[136.4400905095988,35.87819455842276],[136.43563258140188,35.87386005487022],[136.43574976402394,35.86922647546123],[136.42927530033896,35.860699689076625],[136.4327469211942,35.85486905367499],[136.4331751346912,35.85414979721472],[136.43163200705925,35.845822404277506],[136.42941495627963,35.84048422914912],[136.426926059992,35.83894853605833],[136.42428015359906,35.835512525468666],[136.4261484577329,35.8302787606755],[136.42918750170236,35.82575363523101],[136.4259270414588,35.82375176874728],[136.42490627379743,35.82171449990809],[136.42668796007428,35.813832024306485],[136.43345022527993,35.809569869436395],[136.43396466718352,35.80548967551588],[136.4324429089748,35.802333177686755],[136.43242584369258,35.79936326454673],[136.42723161572613,35.79683965403912],[136.42380206649582,35.794857422490615],[136.42171453915648,35.790160653011625],[136.41818171895721,35.78496504569683]
  ];
  const testCoordinates2: number[][] = [
    [136.1508954684977,35.79515739899356],[136.15013526008474,35.78985322082524],[136.14322035839706,35.7862080892401],[136.13713108444327,35.782981897926206],[136.1332139521256,35.78248053935966],[136.1289785701271,35.77912837689884],[136.125070897184,35.778770654838816],[136.1227681832614,35.77798027015568],[136.11974374298555,35.77515436061226],[136.11684970045312,35.77340768614958],[136.11733230605913,35.77016679407091],[136.11674692543443,35.768801245983674],[136.11521608034155,35.76862476927139],[136.1145596047729,35.76702058864587],[136.11855601049422,35.75982890085093],[136.1186214985106,35.75519559493761],[136.12393477201755,35.75126953875075],[136.1272803625719,35.74722676483842],[136.1320792539335,35.743349835815394],[136.13513945334762,35.74038739038058],[136.13527764998852,35.73652596736693],[136.134250847362,35.732487889621126],[136.13526239077333,35.72761588128189],[136.1355482932032,35.72440791849716],[136.14461855006058,35.71814546609157],[136.1500691097109,35.713854031030706],[136.15170882474115,35.70965160412599],[136.15161153630115,35.709391278887],[136.15067335087684,35.70688078235112],[136.14644223897577,35.704760582443136],[136.15168919671686,35.69948771077057],[136.158698671609,35.70267138289499],[136.16209479932087,35.701490307135984],[136.16827284020368,35.70064083402471],[136.16900193943965,35.70450434215521],[136.17096119931756,35.70559353101],[136.17261690903158,35.70507352992187],[136.1764792402462,35.705933058969066],[136.18156786774142,35.704905877073735],[136.18527687320005,35.705488457547126],[136.1896021569986,35.70531408105639],[136.196083392941,35.702028326135235],[136.199159024018,35.69563937754412],[136.19930896721215,35.693020770215966],[136.2006955387707,35.69185686626813],[136.20429765007552,35.69067548736985],[136.20913752120333,35.690332342465105],[136.21291186006576,35.686064242245415],[136.21478475555503,35.68611966147765],[136.21777372811286,35.68712188130452],[136.22312572860804,35.686355356993914],[136.2285320134128,35.683999178464354],[136.2314587989755,35.68390288488061],[136.23434554658076,35.6851573219067],[136.23681425689557,35.68431243390793],[136.24020175698888,35.68077756492411],[136.2437976583301,35.67808234535666],[136.2466765032498,35.67664861475316],[136.25460610690342,35.67705312668212],[136.26001193496273,35.67446775728473],[136.26467123147543,35.674398140915635],[136.26787267594838,35.67379711167971],
    [136.27317645345096,35.670459026338555],[136.2768824432881,35.668312464445734],[136.2798637133239,35.66717730877629],[136.28284750251981,35.666403712590906],[136.28691998192045,35.66686270748062],[136.2910085255651,35.670001092052],[136.29175018671583,35.67403867297248],[136.2955614038532,35.677469683255836],[136.29963557545085,35.67995929753276],[136.29913526232633,35.68245538007842],[136.29616405414353,35.68620498178321],[136.293623489697,35.688349668777875],[136.29356738214676,35.69286427294552],[136.29949009707246,35.69584667945318],[136.3026523213137,35.698009605172345],[136.30467225177733,35.701383520596444],[136.30671552699258,35.70376145601825],[136.30862723469613,35.7045449699825],[136.31137247681235,35.706882464642014],[136.31159850046072,35.70707490832569],[136.31284657893167,35.71017986179184],[136.31340939209045,35.713262144100796],[136.31893589716398,35.7176295384407],[136.32345137746424,35.718211120444806],[136.32491826857506,35.72070198959032],[136.32201469087292,35.72320461397836],[136.3223146751262,35.72534222703866],[136.32407353223277,35.727951121710156],[136.32685385174372,35.73091362118349],[136.32818122957895,35.73483043151927],[136.32658767462752,35.737091979817244],[136.32660805153665,35.74208154886577],[136.32531977450932,35.74778746224347],[136.3208212093061,35.75255155866574],[136.32009016265752,35.75560806709607],[136.32140305272944,35.757580003792626],[136.32154174605898,35.75778831201763],[136.3219681993452,35.76131535736921],[136.32405980614334,35.76878612746693],[136.3289368372865,35.77708971462552],[136.3328597434823,35.77867538210165],[136.34141459218392,35.77764259846526],[136.34739866778148,35.77888548380821],[136.35644255637402,35.7870514031941],[136.3560302144129,35.79210128999959],[136.35276793597382,35.79644701125152],[136.3523128709415,35.7995934136877],[136.3543270401116,35.80273880451754],[136.35339165676325,35.80559272369132],[136.34946785494984,35.808752389578096],[136.3487478253129,35.81083348349478],[136.3505889136525,35.81492666603928],[136.34906072471006,35.8174832506006],[136.34696121305353,35.81927340288604],[136.34551144423693,35.8212972172053],[136.3414405360552,35.8243384746433],[136.33685526963754,35.8238949018893],[136.3329686087821,35.822751817933096],[136.3262758145481,35.82571037487305],[136.31975791664647,35.820519142509994],[136.3165393356623,35.81978578723809],[136.31501907181874,35.82187557971223],[136.31420458388416,35.82456583529463],[136.3126641953869,35.82624993775053],[136.30863948844325,35.8264294179446],[136.3031915829244,35.83139888854477],[136.30029781350544,35.82980983637158],[136.29966855238794,35.826955238407],[136.29303914031794,35.825822005312475],[136.28841351710125,35.8232024705204],[136.28318020544245,35.824016482950405],[136.27973610863273,35.82420565583913],[136.2745989375886,35.825418847081245],[136.26877305555485,35.825082377748636],[136.26124496442955,35.82580298832682],[136.259644042615,35.825956170727714],[136.26038804991137,35.83259075826467],[136.2607026479865,35.83904327234204],[136.25696885123654,35.843806684015625],[136.25908856145819,35.845362103028215],[136.26580878019072,35.849547712756134],[136.27223420715694,35.857849533014395],[136.2776385547574,35.86784187177237],[136.2877418585301,35.86596173177274],[136.28981226570812,35.8678048976467],[136.29435773287798,35.86922218448247],[136.30005017497442,35.87315583683626],[136.3038752400756,35.87591989478155],[136.30616008427805,35.87843270848021],[136.30664952437337,35.88023797697451],[136.3077304269938,35.88422481717059],[136.31218693133744,35.88874941275704],[136.3127209188217,35.89328416810755],[136.31127248309963,35.89516792783952],[136.3103681185458,35.89875047146613],[136.3118275360199,35.90235878690563],[136.31214647482358,35.90471003200149],[136.31595303476445,35.90875605657238],[136.3156647646895,35.91396499513373],[136.31215705404608,35.9146465899104],[136.31065600737847,35.91639513512782],[136.31414235090043,35.9203533368557],[136.31776709026704,35.92211928048664],[136.32623299701356,35.922257962311676],[136.33451602159,35.9270210466364],[136.33520661180097,35.92986904009487],[136.33449731874848,35.933039410650906],[136.33474079394583,35.93810890047514],[136.33474854908977,35.94064168595937],[136.33229524550376,35.94285735448519],[136.3320625956264,35.944628848850066],[136.33880872301808,35.95078754810516],[136.33801271255018,35.95257171497963],[136.33184045925572,35.95317422108427],[136.32771182551195,35.952243946263806],[136.32373734436726,35.95422985613102],[136.32478277079133,35.956318346036355],[136.32496235533827,35.95765816677147],[136.31868925196972,35.9595769367406],[136.31892271116672,35.96385734054137],[136.31900669634769,35.96539706163982],[136.31520314640983,35.9674759148738],[136.3128598627667,35.966056287123244],[136.3125622460594,35.966047371196076],[136.3125622289992,35.966047361967355],[136.3055532455735,35.965837183295825],[136.29572136288766,35.97441584796823],[136.28797068645758,35.97500636929107],[136.28431912940155,35.97508094671751],[136.28122232529458,35.97412618688786],[136.277013468212,35.97404409213789],[136.2764978029808,35.97713218626497],[136.27565408734748,35.982184831148786],[136.2776385547574,35.98690540177907],[136.27883702139692,35.993819822743916],[136.28529241421884,36.00045754476846],[136.29248547325236,36.0083394258948],[136.29351381411072,36.009821863344634],[136.2938123549232,36.01142485635831],[136.2928769120888,36.015525527101516],[136.2905541301561,36.02010537876552],[136.28704780015946,36.02000180144719],[136.2826711861147,36.02033908014384],[136.2806155049962,36.02109407798431],[136.2798948497431,36.021531220604615],[136.27566437730138,36.02409720015025],[136.27090638022148,36.02485636383442],[136.25816315395468,36.02594864037156],[136.24920539207469,36.0311543845533],[136.24455628157196,36.037232217414015],[136.24150404682783,36.043653253820324],[136.23938996041866,36.045914589059606],[136.23632348810506,36.047643253016076],[136.2324797410973,36.049253516651056],[136.22945851842377,36.051220423203304],[136.2176065917332,36.051697894496144],[136.2075934996414,36.063177627357554],[136.19925951094947,36.062906920662996],[136.19325227438804,36.065138179957195],[136.18664431417045,36.070887963523],[136.18243924857742,36.07689520008428],[136.1807405287704,36.082917933945375],[136.17430233836433,36.07874391463259],[136.16007497914876,36.07641014305409],[136.15576743444242,36.072722398575465],[136.1375566096969,36.07054469286235],[136.13266500278257,36.073205040482364],[136.1245190487091,36.073262205866406],[136.1173797986468,36.07226112038997],[136.11592572758943,36.068566534567026],[136.11054030558742,36.06512783390963],[136.10495210829092,36.062361189742944],[136.08715068079567,36.05582647499177],[136.07893705982823,36.05159898777467],[136.07607411939358,36.05012521504722],[136.0676985468754,36.048195241386814],[136.0676985468754,36.04819524138684],[136.06391315960474,36.0452942556059],[136.0573898519958,36.034965037086394],[136.05334153395424,36.01556196436449],[136.05168337094372,36.011362895764606],[136.0489924688123,36.008508468358116],[136.0451665009756,36.003047706336105],[136.03679236487955,35.99918687196995],[136.02914088575852,35.99389772799477],[136.02541793581014,35.990287096192496],[136.02345155190608,35.98583576623161],[136.01942312885677,35.98365076921417],[136.0204355367405,35.97632507057332],[136.0220029927886,35.975165909226426],[136.01494990459545,35.96802341651935],[136.01187233072196,35.96214813029663],[136.01176760184828,35.95845206440949],[136.01425063260606,35.95525974319813],[136.01435312456232,35.94866241377101],
    [136.02034479670436,35.94820278096731],[136.02065286985598,35.94459057333207],[136.01724069137566,35.939381606731835],[136.01620583587203,35.93182156180269],[136.01037765522224,35.9314366861983],[136.0112478128628,35.92938638632421],[136.0151709987542,35.9254374120419],[136.0120719653731,35.91787751320855],[136.0135183336583,35.91451802371912],[136.01640872622258,35.91241729690195],[136.01867979626454,35.91090473048263],[136.01949220567843,35.905253969371714],[136.0258024761017,35.905022956509434],[136.02383874290317,35.89947923994257],[136.02094664293895,35.89628783003748],[136.02103039438532,35.8941858922817],[136.02084009022167,35.88167104693454],[136.02409642300637,35.87929484270271],[136.03136773173483,35.87914866126268],[136.03438782564103,35.880635852985534],[136.036747387699,35.88063497596916],[136.04768974483528,35.874751223058226],[136.05177441458918,35.871898088345816],[136.0661498217448,35.87028738616373],[136.07206846168702,35.867169912755706],[136.07168301707077,35.86151171474109],[136.07165073933285,35.861037851083466],[136.07299055453518,35.859189039210534],[136.0757747355642,35.85717143771602],[136.07969079660907,35.85137304622664],[136.08072026964126,35.84960800580972],[136.08546280829515,35.84565619967619],[136.09659305315853,35.846094683380386],[136.09990924943577,35.84673686698123],[136.1019721836843,35.84631508747259],[136.1045730648111,35.844545950975395],[136.1086772879331,35.84538532286549],[136.11317341600392,35.84737824056783],[136.11559434891177,35.84840309815363],[136.11848348469297,35.84848413395613],[136.12068123567838,35.8476542612403],[136.1226400068663,35.84672791999737],[136.12717930679946,35.84638657107434],[136.12965278600095,35.84436775952009],[136.13057802469598,35.84251857871177],[136.1301528212368,35.83554678240543],[136.1324137277741,35.830336461339186],[136.1317848883277,35.82504500269718],[136.13589927407497,35.817058928789066],[136.13774546179556,35.81117656228881],[136.14042292108087,35.80856975474662],[136.1406527237047,35.80388616151914],[136.14434013465396,35.798730068924215],[136.1485678412793,35.79801167585224],[136.1508954684977,35.79515739899356]
  ];
  const testCoordinates3: number[][] = [
    [136.41818171895721,35.78496504569683],[136.42171453915648,35.790160653011625],[136.42380206649582,35.794857422490615],[136.42723161572613,35.79683965403912],[136.43242584369258,35.79936326454673],[136.4324429089748,35.802333177686755],[136.43396466718352,35.80548967551588],[136.43345022527993,35.809569869436395],[136.42668796007428,35.813832024306485],[136.42490627379743,35.82171449990809],[136.4259270414588,35.82375176874728],[136.42918750170236,35.82575363523101],[136.4261484577329,35.8302787606755],[136.42428015359906,35.835512525468666],[136.426926059992,35.83894853605833],[136.42941495627963,35.84048422914912],[136.43163200705925,35.845822404277506],[136.4331751346912,35.85414979721472],[136.4327469211942,35.85486905367499],[136.42927530033896,35.860699689076625],[136.43574976402394,35.86922647546123],[136.43563258140188,35.87386005487022],[136.4400905095988,35.87819455842276],[136.44063203587285,35.88728974397943],[136.43413597730918,35.890788156692224],[136.43620756889516,35.89216616281067],[136.43365125941762,35.89666950245317],[136.4346515139982,35.89998492329955],[136.43932443852492,35.905008720636644],[136.44108592162553,35.90617859579828],[136.44111297675585,35.91130262444317],[136.44607520907863,35.91212234838183],[136.45135368170605,35.91437080164723],[136.45641002003052,35.91532014512776],[136.46036517615875,35.91946146148543],[136.46234295096997,35.922310184537885],[136.4656553609136,35.922800566890174],[136.4668996374494,35.92363585105348],[136.46718033670658,35.92559154575693],[136.4659148492407,35.93136839293955],[136.4626547262135,35.93944474301437],[136.4621902450383,35.94537482278103],[136.46479584955054,35.952121006029074],[136.46408254806832,35.95388769846369],[136.45926490290148,35.95470751609246],[136.45806784882598,35.9556933160472],[136.45583669876547,35.957530619482846],[136.45555815078382,35.96307572949761],[136.45643319344887,35.97155637315858],[136.45232667295647,35.976444037291415],[136.45349665439537,35.98215162371814],[136.4480842436082,35.986376659967064],[136.45054218759665,35.9896389204527],[136.45562165115305,35.992139604814945],[136.45590206872924,36.00490662284928],[136.45168831148783,36.00912268758004],[136.45260865432962,36.0129138524732],[136.45730012191345,36.014309363997924],[136.45931583154047,36.01771108737825],[136.4507488037446,36.02069608802284],[136.44831995064814,36.0221298056328],[136.4448172215937,36.024197417088224],[136.44283474348632,36.029210349189036],[136.4427031127413,36.029364295536716],[136.43987257404984,36.032674520828344],[136.43513336389918,36.03873180325001],[136.43423279159748,36.04394326251826],[136.4290813087991,36.042224204696694],[136.42495336508347,36.04200501836492],[136.4203908842606,36.041762759823904],[136.4092574815292,36.04505616636362],[136.3972239681008,36.04902773383585],[136.38397750851888,36.04764553495096],[136.37897885871834,36.04219787205061],[136.37303589889711,36.038058838271816],[136.369441916171,36.035694525684484],[136.36923455817052,36.03566731236718],[136.36639589140978,36.03529477038495],[136.35656497010393,36.03628495360899],[136.3529195413568,36.03675469046064],[136.3467159258531,36.043060951100685],[136.34565337391945,36.04817891628836],[136.3436169241179,36.050916784357504],[136.34060334780364,36.05295145403753],[136.33622663632264,36.053723824768745],[136.33235687921908,36.04951633759415],[136.31918558401867,36.049640369805175],[136.31894214403056,36.04224746801341],[136.31670537190328,36.04181049802583],[136.3146945036189,36.040832613314784],[136.31277751453834,36.03703635888216],[136.30947414266294,36.03377798455618],[136.3086937733283,36.02160360678794],[136.30758050626434,36.01691371318604],[136.305624448446,36.016030379510774],[136.30335905462937,36.01803405864411],[136.30087163835424,36.021623119989],[136.29678613249084,36.02400937475966],[136.2923913478254,36.02394945429758],[136.29233175164947,36.02395103802279],[136.29055598870286,36.020104938400706],[136.292878753248,36.01552509204708],[136.29381417744992,36.011424427842186],[136.29351562802543,36.009821438565254],[136.2924872776982,36.00833900590845],[136.2852941658234,36.000457155495134],[136.27883872979803,35.99381945691335],[136.27764022797425,35.98690505197664],[136.2756557352549,35.98218449370483],[136.27649942674987,35.97713185802899],[136.2770150774955,35.974043769590295],[136.28122394047932,35.974125859499566],[136.28432075334288,35.975080613958696],[136.28797231479024,35.975006032537436],[136.2957229968795,35.97441550219167],[136.3055548460858,35.96583684600417],[136.31256383687546,35.966047016314675],[136.3125638539357,35.96604702554335],[136.31286147101642,35.96605594105475],[136.31520476511014,35.96747556188939],[136.31900830769692,35.96539670934791],[136.31892431394994,35.96385699272823],[136.31869083097575,35.95957660134215],[136.32496392948238,35.957657829949234],[136.3247843376411,35.95631801342213],[136.32373889927564,35.95422953081735],[136.32771337278317,35.95224362262994],[136.33184201465752,35.95317389007221],[136.3380142690177,35.95257137880309],[136.33881026972915,35.950787216219766],[136.33206410401039,35.9446285424485],[136.33229674421693,35.94285705292706],[136.33475003684475,35.9406413883606],[136.33474226818922,35.93810860963737],[136.33449876594435,35.93303913362263],[136.33520804346023,35.92986877175889],[136.33451743870233,35.92702078716783],[136.32623438745298,35.92225772157955],[136.3177684785498,35.92211904360533],[136.3141437309264,35.92035310550483],[136.31065736970768,35.916394913435326],[136.31215840914209,35.91464637170986],[136.31566611664317,35.913964777839595],[136.31595436364563,35.90875585013245],[136.31214778939452,35.904709831198446],[136.31182884204048,35.902358589166695],[136.31036941207668,35.89875027779747],[136.3112737644877,35.89516773795437],[136.31272219352005,35.893283980516685],[136.3121881930721,35.88874922849684],[136.30773167765324,35.88422463401429],[136.30665076567323,35.88023779326988],[136.30616132147435,35.8784325243019],[136.30387647191645,35.87591970962667],[136.30005140183303,35.873155650119116],[136.29435895187797,35.869221996060915],[136.2898134818735,35.867804708828],[136.28774307124868,35.86596154241389],[136.27763976911436,35.86784168288347],[136.27223539953016,35.8578493424157],[136.26580995386502,35.84954752209515],[136.25908972401245,35.8453619129855],[136.25697000976476,35.84380649436965],[136.260703801498,35.83904307734689],[136.26038919422433,35.83259055897188],[136.25964517690053,35.82595596581636],[136.26124610024368,35.825802781885194],[136.2687741973518,35.825082163935406],[136.27460008501274,35.82541862854727],[136.2797372593708,35.82420543234261],[136.28318135916697,35.824016256854435],[136.28841467484526,35.82320223989612],[136.2930403030446,35.825821776168866],[136.29966972015438,35.82695500782797],[136.300298983511,35.82980960929102],[136.30319275527546,35.83139866216017],[136.30864065990264,35.826429181086816],[136.31266536854642,35.826249698094124],[136.31420575707833,35.824565592146755],[136.315020244469,35.8218753317186],[136.31654050827768,35.8197855350858],[136.31975909134644,35.820518890149486],[136.3262769956482,35.82571012826775],[136.33296979008742,35.822751563422294],[136.33685645244017,35.82389464755624],[136.3414417209193,35.82433821901163],[136.34551262989663,35.82129695469559],[136.346962398683,35.81927313635895],[136.34906191067589,35.817482980156804],[136.35059009931445,35.81492639068263],[136.34874900892305,35.810833201912324],[136.3494690381863,35.80875210428959],[136.35339283993673,35.80559243225881],[136.35432822254165,35.80273850812066],[136.35231405198599,35.79959311238564],[136.35276911688226,35.79644670379271],[136.3560313950384,35.79210097413229],[136.35644373692963,35.78705107808981],[136.36279866838137,35.78952652292985],[136.36812599700707,35.79052010274552],[136.37296770900255,35.79426997943776],[136.377514038245,35.79627223363277],[136.38493741263773,35.795834504084034],[136.3880291187507,35.79565219740737],[136.39059043424973,35.79203223373071],[136.39401042378555,35.79008313857948],[136.39831715708027,35.79049664516842],[136.4023373830832,35.79115345826205],[136.40319636579866,35.787912048871725],[136.4063341582649,35.78601666166355],[136.40931461330743,35.7839912031185],[136.41270705272044,35.78279952336959],[136.4148735533718,35.78312818574889],[136.41818171895721,35.78496504569683]
  ];
  useEffect(() => {
    if (map.current) return;

    const initialize = async () => {

      map.current = new maplibregl.Map({
        container: mapContainer.current!,
        style: 'https://api.maptiler.com/maps/hybrid/style.json?key=78Xkqpun692Y6h0xFFBK',
        center: [136.3629244,35.8659201],
        zoom: 9,
        pitch: 45,
        bearing: -17.6,
      });

      map.current.addControl(new maplibregl.NavigationControl(), 'top-right');

      map.current.on('load', async () => {
        addPolygonLayer(map.current!, 'test1', testCoordinates, '#ddd', '#000', 0.4);
        try {
          const response = await fetch('/rivClass1.geojson');
          
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          const geojson: GeoJSON.FeatureCollection = await response.json();

          map.current!.addSource('rivClass1', {
            type: 'geojson',
            data: geojson,
          });
    
          map.current!.addLayer({
            id: 'rivClass1-layer',
            type: 'line',
            source: 'rivClass1',
            layout: {},
            paint: {
              'line-color': '#0077ff',
              'line-width': 3,
            },
          });
        } catch (error) {
          console.error(':', error);
        }

        try {
          const response = await fetch('/watershed.geojson');
          
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          const geojson: GeoJSON.FeatureCollection = await response.json();
          
          const features = Array.isArray(geojson) ? geojson : geojson.features;

          features.forEach((feature: any) => {
            const id = feature.properties.id
            const sourceId = `geojson-source-${id}`;
            const layerId = `geojson-layer-${id}`;
    
            map.current!.addSource(sourceId, {
              type: 'geojson',
              data: feature,
            });
    
            map.current!.addLayer({
              id: layerId,
              type: 'line',
              source: sourceId,
              layout: {},
              paint: {
                'line-color': '#ff5500',
                'line-width': 2,
              },
            });

            map.current!.addLayer({
              id: `${layerId}-fill`,
              type: 'fill',
              source: sourceId,
              layout: {},
              paint: {
                'fill-color': '#f08',
                'fill-opacity': 0.4,
              },
            });
          });
        } catch (error) {
          console.error(':', error);
        }

        map.current!.on('click', 'geojson-layer-067-fill',  async function (e) {

          addSelectedPlaces('')
          map.current!.removeLayer('geojson-layer-067-fill');
          map.current!.removeLayer('geojson-layer-067');
          
          addPolygonLayer(map.current!, '067', rainCoordinates, '#22ff00', '#f08', 0.1);
          try {
            const response = await fetch('/hanran_067.geojson');
            
            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
            }
            const geojson: GeoJSON.FeatureCollection = await response.json();
  
            map.current!.addSource('hanran_067', {
              type: 'geojson',
              data: geojson,
            });
      
            map.current!.addLayer({
              id: 'hanran_067-layer',
              type: 'line',
              source: 'hanran_067',
              layout: {},
              paint: {
                'line-color': '#22ff',
                'line-width': 3,
              },
            });
          } catch (error) {
            console.error(':', error);
          }
        });
        
        map.current!.on('click', 'hanran_067',  function (e) {
          addSelectedPlaces('')
        });

        map.current!.on('click', '067-fill',  function (e) {
          setSelectedPlaces(['', ''])
          map.current!.removeLayer('hanran_067-layer');
          map.current!.removeLayer('067-fill');
          addPolygonLayer(map.current!, 'test1', testCoordinates, '#ddd', '#000', 0.4);
          addPolygonLayer(map.current!, 'test2', testCoordinates2, '#ddd', '#000', 0.4);
          addPolygonLayer(map.current!, 'test3', testCoordinates3, '#ddd', '#000', 0.4);
        });

        
      });
    }
    initialize();
  }, []);

  const addSelectedPlaces = (info: string) => {
    const updatedPlaces = [...selectedPlaces, info];

    setSelectedPlaces(updatedPlaces);
    updatedPlaces.forEach((place, index) => {
      console.log(`Place ${index + 1}: ${place}`);
    });
  };

  const removeSelectedPlaces = (index: number) => {
    setSelectedPlaces(selectedPlaces.filter((_, i) => i !== index));
  };

  const closeRainfall = () => {
    setopenRainfall(false);
    setChangeWidth('100%');
  };

  const closeClimateChangePrediction = () => {
    setopenClimateChangePrediction(false);
    setChangeWidth('100%');
  };

  const handleRainfall = () => {
    setopenRainfall(true);
    setChangeWidth('60%');
  };
  const handleClimateChangePrediction = () => {
    setopenClimateChangePrediction(true);
    setChangeWidth('60%');
  };

  const clearSelection = () => {
    setSelectedPlaces([]);
  };

  return (
    <div style={{ display: 'flex'}}>
      <div ref={mapContainer} style={{ width: changeWidth, height: '100vh', position: 'relative' }}>
        <LogoImg></LogoImg>
        {!(openRainfall || openClimateChangePrediction) && selectedPlaces.length > 0 && (
          <SelectPlaceName>
            <CloseButton onClick={clearSelection}></CloseButton>
            {selectedPlaces.map((selectedPlace, index) => (
              <SelectedText key={index}>{selectedPlace}</SelectedText>
            ))}
            <SelectButton></SelectButton>
          </SelectPlaceName>
        )}

        <IconContents>
          <StorageIcon />
          <SplitscreenIcon />
          <LogoutIcon />
        </IconContents>

        <SearchContents>
          <SearchButton onClick={handleRainfall}></SearchButton>
          <FutureSearchButton onClick={handleClimateChangePrediction}></FutureSearchButton>
        </SearchContents>
      </div>
      {openRainfall &&
        <div style={{width: '40%', height: '100vh'}}>
          <SearchRainfallData selectedPlaces={selectedPlaces} closeRainfall={closeRainfall} />
        </div>
      }
      {openClimateChangePrediction &&
        <div style={{width: '40%', height: '100vh'}}>
          <SeachClimateChangePrediction selectedPlaces={selectedPlaces} closeClimateChangePrediction={closeClimateChangePrediction} />
        </div>
      }
    </div>
  );
};

export default MapRasterComponent;
